<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Spark</title>
    <style>
        :root{
            --bg:#ffffff; --fg:#0f172a; --muted:#6b7280; --card:#f8fafc; --line:#e5e7eb;
            --btn:#0ea5e9; --btn-fg:#ffffff; --btn-hover:#0284c7; --warning:#b91c1c; --ok:#059669;
            --accent:#22c55e;
        }
        @media (prefers-color-scheme: dark){
            :root{ --bg:#0b0f19; --fg:#e5e7eb; --muted:#94a3b8; --card:#0f172a; --line:#1f2937;
                --btn:#0284c7; --btn-fg:#e5e7eb; --btn-hover:#0369a1; --warning:#ef4444; --ok:#10b981; --accent:#10b981; }
        }
        [data-theme="light"]{ --bg:#ffffff; --fg:#0f172a; --muted:#6b7280; --card:#f8fafc; --line:#e5e7eb;
            --btn:#0ea5e9; --btn-fg:#ffffff; --btn-hover:#0284c7; --warning:#b91c1c; --ok:#059669; --accent:#22c55e;}
        [data-theme="dark"]{ --bg:#0b0f19; --fg:#e5e7eb; --muted:#94a3b8; --card:#0f172a; --line:#1f2937;
            --btn:#0284c7; --btn-fg:#e5e7eb; --btn-hover:#0369a1; --warning:#ef4444; --ok:#10b981; --accent:#10b981;}

        /* Reset + base */
        *,*::before,*::after{ box-sizing:border-box; }
        html,body{ margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; }

        /* ===== POPUP defaults =====
           Give the popup a real width so it doesn't collapse to a thin strip. */
        .wrap{
            width: 400px;          /* popup width */
            max-width: 420px;
            min-width: 360px;
            margin: 0;             /* no centering in popup */
            padding:12px;
            display:flex; flex-direction:column; gap:10px;
        }

        /* ===== FULL-PAGE MODE =====
           Activated when popup.js sets html[data-fullpage="1"] (only if URL hash is #drafts or #full) */
        html[data-fullpage="1"] .wrap{
            width: min(1100px, 96vw);
            max-width: 1100px;
            min-width: 720px;
            margin: 0 auto;
            padding: 24px;
            gap: 16px;
        }
        html[data-fullpage="1"] .tabs{ position: sticky; top: 0; z-index: 5; }

        .topbar{ display:flex; align-items:center; justify-content:space-between; }
        h1{ font-size:16px; margin:0; display:flex; align-items:center; gap:8px; }
        .badge{ font-size:10px; color:var(--btn-fg); background:var(--btn); padding:2px 6px; border-radius:999px; }

        .tabs{ display:flex; gap:6px; background:var(--card); border:1px solid var(--line); border-radius:12px; padding:4px; }
        .tab{ flex:1; text-align:center; padding:8px; border-radius:10px; cursor:pointer; color:var(--muted); user-select:none; }
        .tab.active{ background:var(--bg); color:var(--fg); border:1px solid var(--line); }

        .card{ background:var(--card); border:1px solid var(--line); border-radius:12px; padding:12px; }
        .row{ display:flex; gap:8px; }
        .row > *{ flex:1; }
        label{ font-size:12px; color:var(--muted); display:block; margin-bottom:4px; }

        textarea, select, input[type="text"]{
            width:100%; border:1px solid var(--line); background:transparent; color:var(--fg);
            border-radius:10px; padding:10px; outline:none;
        }
        textarea{ min-height:88px; resize:vertical; }

        .muted{ color:var(--muted); font-size:12px; }
        .actions{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; }
        .actions-2{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }

        button.primary{ background:var(--btn); color:var(--btn-fg); border:none; border-radius:10px; padding:10px; cursor:pointer; }
        button.primary:hover{ background:var(--btn-hover); }
        button.ghost{ border:1px solid var(--line); background:transparent; color:var(--fg); border-radius:10px; padding:10px; cursor:pointer; }
        button:disabled{ opacity:.6; cursor:not-allowed; }

        #out{ white-space:pre-wrap; background:var(--bg); border:1px dashed var(--line); border-radius:10px; padding:10px; min-height:64px; }

        #variantsBar{ display:none; gap:6px; margin-top:8px; flex-wrap:wrap; }
        #variantsBar button{
            padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:transparent;
            color:var(--fg); font-size:12px; cursor:pointer;
        }

        .statusline{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
        .status{ font-size:12px; color:var(--muted); }
        .spinner{ width:14px; height:14px; border:2px solid var(--line); border-top-color:var(--btn); border-radius:50%; display:none; animation:spin .8s linear infinite; }
        @keyframes spin{ to{ transform:rotate(360deg); } }

        .meter{ height:6px; background:var(--line); border-radius:999px; overflow:hidden; }
        .meter > .bar{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--btn)); transition:width .15s ease; }

        .section-title{ font-size:12px; color:var(--muted); margin:0 0 6px 0; text-transform:uppercase; letter-spacing:.04em; }

        .toast{ position:fixed; inset:auto 12px 12px auto; background:var(--fg); color:var(--bg);
            padding:8px 10px; border-radius:10px; font-size:12px; opacity:0; transform:translateY(6px);
            transition:.25s; }
        .toast.show{ opacity:1; transform:translateY(0); }

        /* Drafts manager */
        .draft-card{ background:var(--bg); border:1px solid var(--line); border-radius:10px; padding:10px; margin-bottom:8px; }
        .draft-meta{ font-size:12px; color:var(--muted); margin-bottom:6px; display:flex; gap:8px; flex-wrap:wrap; }
        .variant{ background:transparent; border:1px dashed var(--line); border-radius:8px; padding:8px; margin:6px 0; }
        .variant-actions{ display:flex; gap:6px; margin-top:6px; }
        .toolbar{ display:flex; gap:8px; justify-content:space-between; align-items:center; margin-bottom:6px; }

        .draft-grid{ display:grid; gap:12px; }
        @media (min-width: 720px){
            html[data-fullpage="1"] .draft-grid{ grid-template-columns: 1fr 1fr; }
        }
        @media (min-width: 1140px){
            html[data-fullpage="1"] h1{ font-size:18px; }
        }
    </style>
</head>
<body>
<div class="wrap" id="root">
    <div class="topbar">
        <h1>⚡ Spark <span class="badge">AI Socials</span></h1>
        <div class="theme">
            <button id="themeAuto">Auto</button>
            <button id="themeLight">Light</button>
            <button id="themeDark">Dark</button>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" data-view="compose">Compose</div>
        <div class="tab" data-view="agent">Agent</div>
        <div class="tab" data-view="drafts">Drafts</div>
        <div class="tab" data-view="settings">Settings</div>
    </div>

    <!-- Compose -->
    <section id="view-compose">
        <div class="card">
            <div class="section-title">Input</div>
            <label for="input">Idea or text</label>
            <textarea id="input" placeholder="Paste your idea or select text on a page…"></textarea>

            <div class="row" style="margin-top:8px;">
                <div>
                    <label>Platform</label>
                    <select id="platform">
                        <option value="twitter">X/Twitter</option>
                        <option value="linkedin">LinkedIn</option>
                        <option value="instagram">Instagram</option>
                        <option value="tiktok">TikTok</option>
                    </select>
                </div>
                <div>
                    <label>Tone</label>
                    <select id="tone">
                        <option value="punchy">Punchy</option>
                        <option value="professional">Professional</option>
                        <option value="witty">Witty</option>
                        <option value="concise">Concise</option>
                    </select>
                </div>
            </div>

            <div class="row" style="align-items:center; margin-top:8px;">
                <label class="muted" style="flex:0 0 auto; display:flex; align-items:center; gap:8px; margin:0;">
                    <input id="clean" type="checkbox" style="width:auto;"> Clean (brand-safe)
                </label>
                <div style="flex:1;">
                    <div class="meter"><div id="meterBar" class="bar"></div></div>
                    <div class="muted" id="counter" style="text-align:right; margin-top:4px;">0 / 280</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-title">Create</div>
            <div class="actions">
                <button class="primary" id="btn-generate" title="Ctrl/⌘ + Enter">Generate</button>
                <button class="ghost"   id="btn-variants">Generate 3</button>
                <button class="ghost"   id="btn-rewrite"  title="Ctrl/⌘ + Shift + R">Rewrite</button>
            </div>
            <div class="actions" style="margin-top:8px;">
                <button class="ghost" id="btn-hashtags" title="Ctrl/⌘ + H">Hashtags</button>
                <button class="ghost" id="btn-summarize">Summarize page</button>
                <button class="ghost" id="btn-translate">Translate…</button>
            </div>
            <div class="actions-2" style="margin-top:8px;">
                <button class="ghost" id="btn-copy" title="Ctrl/⌘ + B">Copy</button>
                <button class="ghost" id="btn-insert" title="Ctrl/⌘ + I">Insert</button>
            </div>
        </div>

        <div class="card">
            <div class="section-title">Output</div>
            <div id="out"></div>
            <div id="variantsBar">
                <span class="muted" style="margin-right:4px;">Pick:</span>
                <button id="pick1">1</button>
                <button id="pick2">2</button>
                <button id="pick3">3</button>
            </div>
            <div class="statusline" style="margin-top:8px;">
                <span id="status" class="status">Ready</span>
                <span id="spin" class="spinner"></span>
            </div>
        </div>
    </section>

    <!-- Agent -->
    <section id="view-agent" style="display:none;">
        <div class="card">
            <div class="section-title">Agent</div>
            <div class="row" style="align-items:center;">
                <label class="muted" style="display:flex;align-items:center;gap:8px;margin:0; flex:1;">
                    <input id="agentEnabled" type="checkbox" style="width:auto;"> Enable Daily Planner Agent
                </label>
                <select id="agentFrequency" title="Frequency" style="max-width:160px;">
                    <option value="60">Hourly</option>
                    <option value="180">Every 3 hours</option>
                    <option value="720" selected>Daily</option>
                </select>
            </div>
            <input id="agentTopic" placeholder="Campaign topic (e.g., ‘AI tips for students’)" style="margin-top:8px;" />
            <div class="actions-2" style="margin-top:8px;">
                <button class="primary" id="btn-save-agent">Save Agent Settings</button>
                <button class="ghost"   id="btn-run-agent">Run now</button>
            </div>
        </div>

        <div class="card">
            <div class="section-title">Latest Drafts</div>
            <div id="drafts" class="muted"></div>
        </div>
    </section>

    <!-- Drafts -->
    <section id="view-drafts" style="display:none;">
        <div class="card">
            <div class="toolbar">
                <div class="section-title">Recent Drafts</div>
                <div>
                    <button id="btn-delete-all" class="ghost" title="Delete all drafts">Delete all</button>
                </div>
            </div>
            <div id="draftsList" class="muted draft-grid">No drafts yet.</div>
        </div>
    </section>

    <!-- Settings -->
    <section id="view-settings" style="display:none;">
        <div class="card">
            <div class="section-title">Posting</div>
            <div class="row">
                <div>
                    <label>Method</label>
                    <select id="postMethod">
                        <option value="intent">Web Intent (confirm manually)</option>
                        <option value="api">X API (auto-post)</option>
                    </select>
                </div>
                <div>
                    <label>Auto-post after agent</label>
                    <select id="autoPost">
                        <option value="off">Off</option>
                        <option value="ask">Ask me (pick variant)</option>
                        <option value="first">Post first variant</option>
                    </select>
                </div>
            </div>
            <div class="row" style="margin-top:8px;">
                <button id="btn-connect-x" class="primary">Connect X Account</button>
                <button id="btn-disconnect-x" class="ghost">Disconnect</button>
            </div>
            <div class="muted" id="xStatus" style="margin-top:6px;">Not connected</div>
        </div>

<!--        <div class="card">-->
<!--            <div class="section-title">Appearance</div>-->
<!--            <div class="row">-->
<!--                <button id="themeAuto"  class="ghost">Auto</button>-->
<!--                <button id="themeLight" class="ghost">Light</button>-->
<!--                <button id="themeDark"  class="ghost">Dark</button>-->
<!--            </div>-->
<!--            <div class="muted" style="margin-top:6px;">Spark follows your system theme by default.</div>-->
<!--        </div>-->

        <div class="card">
            <div class="section-title">About</div>
            <div class="muted">Auto-posting via X API requires an X developer app and appropriate tier with write access. Web Intent opens the composer for you to confirm. See X API tiers.</div>
        </div>
    </section>
</div>

<div id="toast" class="toast">Copied</div>

<script src="popup.js" type="module"></script>
</body>
</html>
